## Здание 4

Реализовать Rest API эндпоинт для проведения транзакции начисления условных единиц (денег или баллов) от одного пользователя на счет другого. Баланс не может быть отрицательным. В БД проекта должно быть как минимум две обязательных таблицы: пользователи и транзакции.

В рамках этой задачи эндпоинт должен быть доступен без авторизации.

Написать интеграционные тесты, покрывающие как минимум два любых тесткейса (например успешную транзакцию и неуспешную).

Подумать, какие подводные камни могут возникнуть при использовании этого эндпоинта в реальном проекте.

Код должен быть оформлен по стандарту PSR-12. Использовать Php 7.4, Последнюю минорную версию Symfony 4/5, любую удобную реляционную СУБД. Для тестов использовать PhpUnit.
Должна быть возможность развернуть проект локально и запустить тесты. 

## Решение:

Для работы с проектом в разработке обернул его в docker контейнер и добавил для удобства обертку в виде makefile.
Должны быть установлен `docker` и `docker-compose`

#### Сборка проекта:
 - `make init`

#### Для запуска проекта в docker
- `make up`

#### Для остановки приложения
- `make down`

Если необходимо резолвить домен на локальной машине, отличный от `localhost`, необходимо добавить строку в файл `hosts`
```bash
sudo sh -c "echo '127.0.0.1 book24-transaction-api.loc' >> /etc/hosts"
```

Для выполнения консольных комманд приложения `make shell` (переход внутрь контейнера)
Получить справку по командам - `make`

### Выполнение:

Для заполнения базы данных написана фикстура `UserFixture` для создания 2х демо пользователей. 
Если запуск приложения происходит из предоставляемой docker сборки, то данная фистура заполняется автоматически, при выполненнии команды `make init`.
При обычном запуске приложения необходимо вручную запустить загрузку фикстур: `php bin/console doctrine:fixtures:load` 

Для проведения транзакции начисления условных единиц нужно сделать `POST` запрос по url `http://book24-transaction-api.loc/transaction`
Body запроса:
```json
{
    "from_user": "user1@mail.demo",
    "to_user": "user2@mail.demo",
    "amount": 1
}
```
где:
* `from_user` - email пользователя, со счета которого будут сняты средства
* `to_user` - email пользователя, на счет которого будут зачислены средства
* `amount` - количество условных единиц

```bash
curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"from_user": "user1@mail.demo","to_user": "user2@mail.demo","amount": 100}' \
  http://book24-transaction-api.loc/transaction
```

**Responce:**
```json
{
    "id": 1,
    "debit_account": {
        "id": 1,
        "sum": 999,
        "owner": {
            "id": 1,
            "name": "user1",
            "email": "user1@mail.demo"
        }
    },
    "credit_account": {
        "id": 2,
        "sum": 1001,
        "owner": {
            "id": 2,
            "name": "user2",
            "email": "user2@mail.demo"
        }
    },
    "date": "2020-03-29T09:05:37+00:00",
    "amount": 1
}
```


Так же написан тест, где проверяется успешное проведение транзакции, и ошибка проведения транзакции.
Запуск теста: `./bin/phpunit`

##### При использовании данного функционала в реалном проекте существует проблемы:
* У данного роуте не предусмотрена авторизация и безопасность там отсутствует.
* Создание транзакции происходит в основном потоке, я бы вынес это в паралельный поток в очереди.